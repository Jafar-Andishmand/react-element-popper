import t,{forwardRef as e,useRef as r,useMemo as o,useCallback as n,useEffect as i,isValidElement as l}from"react";function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],o=!0,n=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(o=(l=a.next()).done)&&(r.push(l.value),!e||r.length!==e);o=!0);}catch(t){n=!0,i=t}finally{try{o||null==a.return||a.return()}finally{if(n)throw i}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}function d(e,a){var c=e.element,u=e.popper,s=e.position,d=void 0===s?"bottom-center":s,h=e.containerStyle,m=e.arrow,b=e.arrowStyle,y=void 0===b?{}:b,v=e.fixMainPosition,g=e.fixRelativePosition,w=e.offsetY,O=e.offsetX,x=e.animation,j=e.zIndex,P=void 0===j?0:j,E=e.popperShadow,M=e.onChange,S=r(),L=r(),A=r(),z={visibility:"hidden",left:"0",top:"0",position:"absolute"},C=o((function(){return!0===m}),[m]),I=o((function(){return!!u}),[u]),N=n((function(){return{position:d,fixMainPosition:v,fixRelativePosition:g,offsetY:w,offsetX:O,defaultArrow:C,animation:x,zIndex:P,onChange:M}}),[d,v,g,w,O,C,x,M]);return i((function(){if(!I)return e(),L.current.parentNode.style.visibility="hidden",void(A.current&&(A.current.style.visibility="hidden"));function t(t){t&&"resize"!==t.type&&!t.target.contains(S.current)||(t&&e(),p(S,L,A,N(),t))}function e(){A.current&&(A.current.style.transition="none"),L.current&&(L.current.parentNode.style.transition="none")}return t(),document.addEventListener("scroll",t,!0),window.addEventListener("resize",t),function(){document.removeEventListener("scroll",t,!0),window.removeEventListener("resize",t)}}),[I,N]),t.createElement("div",{ref:function(t){S.current=t,a&&(a.current=t),null!=a&&a.current&&(a.current.refreshPosition=function(){return p(S,L,A,N())})},style:f({display:"inline-block",height:"max-content"},h)},c,!0===m?t.createElement("div",{ref:A,className:"ep-arrow ".concat(E?"ep-shadow":""),style:f(f({},z),y)}):l(m)?t.createElement("div",{ref:A,style:f(f({},z),y)},m):null,t.createElement("div",{style:{position:"absolute",left:"0",top:"0",willChange:"transform",visibility:"hidden",boxShadow:E?"0 0 6px #becadb":"",zIndex:P}},t.createElement("div",{ref:L},u)))}var h=e(d);function p(t,e,r,o,n){var i=o.position,l=o.fixMainPosition,a=o.fixRelativePosition,c=o.offsetY,f=void 0===c?0:c,s=o.offsetX,d=void 0===s?0:s,h=o.defaultArrow,p=o.animation,g=o.zIndex,w=o.onChange;if(t.current&&e.current){var O,x,j,P,E=(j=void 0!==window.pageXOffset,P="CSS1Compat"===(document.compatMode||""),{scrollLeft:j?window.pageXOffset:P?document.documentElement.scrollLeft:document.body.scrollLeft,scrollTop:j?window.pageYOffset:P?document.documentElement.scrollTop:document.body.scrollTop}),M=E.scrollLeft,S=E.scrollTop,L=m(t.current,M,S),A=L.top,z=L.left,C=L.height,I=L.width,N=L.right,T=L.bottom,X=m(e.current,M,S),D=X.top,H=X.left,R=X.height,Y=X.width,W=document.documentElement,k=W.clientHeight,B=W.clientWidth,F=e.current.parentNode,U=u(b(F),2),$=U[0],q=U[1],G=function(t){var e=u(t.split("-"),2),r=e[0],o=void 0===r?"bottom":r,n=e[1],i=void 0===n?"center":n,l="top"===o||"bottom"===o,a="left"===o||"right"===o;a&&("start"===i&&(i="top"),"end"===i&&(i="bottom"));l&&("start"===i&&(i="left"),"end"===i&&(i="right"));return[o,i,l,a]}(i),J=u(G,4),K=J[0],Q=J[1],V=J[2],Z=J[3],_=K,tt=function(t,e){return"translate(".concat(t,"px, ").concat(e,"px)")},et=I-Y,rt=C-R,ot="left"===Q?0:"right"===Q?et:et/2,nt=et-ot,it="top"===Q?0:"bottom"===Q?rt:rt/2,lt=rt-it,at=z-H+$,ct=A-D+q,ft=0,ut=0,st=y(t.current),dt=r.current,ht=u(b(dt),2),pt=ht[0],mt=ht[1],bt=m(dt,M,S)||{},yt=bt.left,vt=bt.top,gt=bt.height,wt=void 0===gt?0:gt,Ot=bt.width,xt=void 0===Ot?0:Ot,jt=z-yt+pt,Pt=A-vt+mt,Et=0,Mt=0;for("auto"===K&&(K="bottom"),"auto"===Q&&(Q="center"),V&&(at+=ot,ct+="top"===K?-R:C,dt&&h&&(wt=11,xt=20)),Z&&(at+="left"===K?-Y:I,ct+=it,dt&&h&&(wt=20,xt=11));st;)Lt(m(st,M,S)),st=y(st.parentNode);Lt({top:S,bottom:S+k,left:M,right:M+B,height:k,width:B}),V&&(ct+="bottom"===_?f:-f),Z&&(at+="right"===_?d:-d),p&&V&&!n&&(Mt="bottom"===_?10:-10),p&&Z&&!n&&(Et="right"===_?10:-10),at=at-ft+Et,ct=ct-ut+Mt;var St={top:"bottom",bottom:"top",left:"right",right:"left"}[_];dt&&(ft-ot<0&&(jt+=(O=(at-z)/2)<0?0:O),ft+nt>0&&(jt+=(O=(at+Y-N)/2)>0?0:O),ut-it<0&&(Pt+=(x=(ct-A)/2)<0?0:x),ut+lt>0&&(Pt+=(x=(ct+R-T)/2)>0?0:x),V&&(jt+=I/2-xt/2,"bottom"===_&&(Pt=ct,ct+=wt),"top"===_&&(Pt=(ct-=wt)+R)),Z&&(Pt+=C/2-wt/2,"left"===_&&(jt=(at-=xt)+Y),"right"===_&&(jt=at,at+=xt)),dt.style.height=wt+"px",dt.style.width=xt+"px",dt.style.transform=tt(jt,Pt),dt.setAttribute("direction",St),dt.style.visibility="visible",dt.style.zIndex=g+1),F.style.transform=tt(at,ct),F.style.visibility="visible",!n&&p&&setTimeout((function(){F.style.transition=".4s",F.style.transform=tt(at-Et,ct-Mt),dt&&(dt.style.transition=".4s",dt.style.transform=tt(jt-Et,Pt-Mt))}),18),w instanceof Function&&w({popper:{top:ct,bottom:ct+R,left:at,right:at+Y,height:R,width:Y},element:{top:A,bottom:T,left:z,right:N,height:C,width:I},arrow:{top:Pt,bottom:Pt+wt,left:jt,right:jt+xt,height:wt,width:xt,direction:St},position:_+"-"+(0!==ft?"auto":Q),scroll:{scrollLeft:M,scrollTop:S}})}function Lt(t){var e=t.top,r=t.bottom,o=t.left,n=t.right,i=t.height,c=t.width;if(V){var u=Math.round(A-e+C/2),s=Math.round(i/2);l||(A-(R+f+wt)<e&&u<=s&&"top"===_?(ct+=R+C,_="bottom"):T+R+f+wt>i+e&&u>=s&&"bottom"===_&&(ct-=R+C,_="top")),a||(z+ot<o&&(ft=v(N-xt>o?z+ot-o:-I+ot+xt,ft)),N-nt>n&&(ft=v(z+xt<n?N-nt-n:I-nt-xt,ft)))}if(Z){var h=Math.round(z-o+I/2),p=Math.round(c/2);l||(z-(Y+d+xt)<o&&h<p&&"left"===_?(at+=I+Y,_="right"):N+Y+d+xt>n&&h>p&&"right"===_&&(at-=I+Y,_="left")),a||(A+it<e&&(ut=v(T-wt>e?A+it-e:-C+it+wt,ut)),T-lt>r&&(ut=v(A+wt<r?T-lt-r:C-lt-wt,ut)))}}}function m(t,e,r){if(t){var o=t.getBoundingClientRect(),n=o.top,i=o.left,l=o.width,a=o.height,c=n+r,f=i+e;return{top:c,bottom:c+a,left:f,right:f+l,width:l,height:a}}}function b(t){if(!t)return[0,0];var e=u((t.style.transform.match(/translate\((.*?)px,\s(.*?)px\)/)||[]).map((function(t){return Number(t)})),3),r=e[1],o=void 0===r?0:r,n=e[2];return[o,void 0===n?0:n]}function y(t){if(t&&"HTML"!==t.tagName)return t.clientHeight<t.offsetHeight||t.clientWidth<t.offsetWidth?t:y(t.parentNode)}function v(t,e){return Math.round(Math.abs(t))>Math.round(Math.abs(e))?t:e}export default h;
